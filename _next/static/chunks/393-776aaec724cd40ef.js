"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[393],{17043:function(t,e,r){r.d(e,{Z:function(){return c}});var a=r(85893),n=r(40639),l=r(83234),o=r(20979),s=r(47741),i=r(67294);function c(t){let{onApply:e,title:r="Time Controls"}=t,[c,d]=(0,i.useState)(""),[u,h]=(0,i.useState)(""),[m,p]=(0,i.useState)(""),[f,g]=(0,i.useState)(""),[x,v]=(0,i.useState)(""),[y,S]=(0,i.useState)("");return(0,a.jsxs)(n.xu,{children:[(0,a.jsx)(n.xv,{fontWeight:"semibold",mb:3,children:r}),(0,a.jsxs)(n.gC,{spacing:3,align:"stretch",children:[(0,a.jsxs)(l.NI,{isInvalid:!!x,children:[(0,a.jsx)(l.lX,{fontSize:"sm",children:"Timestamp (system timezone)"}),(0,a.jsxs)(n.Ug,{spacing:2,children:[(0,a.jsx)(o.II,{size:"sm",placeholder:"2024-01-15T10:30:00 (system timezone)",value:c,onChange:t=>d(t.target.value)}),(0,a.jsx)(s.zx,{size:"sm",variant:"outline",onClick:()=>{d(function(){var t,e,r,a,n,l;let o=new Date,s=Intl.DateTimeFormat().resolvedOptions().timeZone,i=new Intl.DateTimeFormat("en-CA",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:s,hour12:!1}).formatToParts(o),c=(null===(t=i.find(t=>"year"===t.type))||void 0===t?void 0:t.value)+"-"+(null===(e=i.find(t=>"month"===t.type))||void 0===e?void 0:e.value)+"-"+(null===(r=i.find(t=>"day"===t.type))||void 0===r?void 0:r.value),d=(null===(a=i.find(t=>"hour"===t.type))||void 0===a?void 0:a.value)+":"+(null===(n=i.find(t=>"minute"===t.type))||void 0===n?void 0:n.value)+":"+(null===(l=i.find(t=>"second"===t.type))||void 0===l?void 0:l.value);return"".concat(c,"T").concat(d)}()),v("")},children:"Now"})]}),x&&(0,a.jsx)(n.xv,{fontSize:"xs",color:"red.500",children:x})]}),(0,a.jsxs)(l.NI,{isInvalid:!!y,children:[(0,a.jsx)(l.lX,{fontSize:"sm",children:"Offset"}),(0,a.jsx)(o.II,{size:"sm",placeholder:"1h, 30m, 2d",value:u,onChange:t=>h(t.target.value)}),y&&(0,a.jsx)(n.xv,{fontSize:"xs",color:"red.500",children:y})]}),(0,a.jsxs)(n.Ug,{spacing:2,children:[(0,a.jsx)(s.zx,{size:"sm",colorScheme:"blue",onClick:()=>{let t,r;if(c.trim())try{t=function(t){arguments.length>1&&void 0!==arguments[1]?arguments[1]:Intl.DateTimeFormat().resolvedOptions().timeZone;try{let e=new Date(t);if(isNaN(e.getTime()))throw Error("Invalid timestamp format");return Math.floor(e.getTime()/1e3)}catch(t){throw Error("Invalid timestamp format")}}(c),p(new Date(1e3*t).toISOString()),v("")}catch(t){v("Invalid timestamp format");return}else p("");if(u.trim())try{r=function(t){let e=t.match(/^(\d+)([smhd])$/);if(!e)throw Error('Invalid duration format. Use format like "30s", "5m", "2h", "1d"');let r=parseInt(e[1]);switch(e[2]){case"s":return r;case"m":return 60*r;case"h":return 3600*r;case"d":return 86400*r;default:throw Error("Invalid time unit. Use s, m, h, or d")}}(u),g(u),S("")}catch(t){S("Invalid offset format (use: 30s, 5m, 2h, 1d)");return}else g("");e(t,r)},children:"Apply"}),(0,a.jsx)(s.zx,{size:"sm",variant:"outline",onClick:()=>{d(""),h(""),p(""),g(""),v(""),S(""),e(void 0,void 0)},children:"Reset"})]}),(m||f)&&(0,a.jsxs)(n.xu,{p:2,bg:"gray.50",borderRadius:"md",children:[(0,a.jsx)(n.xv,{fontSize:"xs",fontWeight:"medium",mb:1,children:"Applied Settings:"}),m&&(0,a.jsxs)(n.xv,{fontSize:"xs",color:"gray.600",children:["Timestamp: ",m]}),f&&(0,a.jsxs)(n.xv,{fontSize:"xs",color:"gray.600",children:["Offset: ",f]})]})]})]})}},23924:function(t,e,r){r.d(e,{Jv:function(){return s},b4:function(){return o},k:function(){return l},qC:function(){return i}});var a=r(52189),n=r(98032);function l(t){let e=[a.rS.colors.green["100"],a.rS.colors.green["300"],a.rS.colors.yellow["400"],a.rS.colors.orange["500"],a.rS.colors.red["700"]].map(t=>(0,n.H)(t)),r=(t=Math.min(t=Math.max(t,0),1))*(e.length-1),l=Math.floor(r);return(0,n.H)(e[l]).mix((0,n.H)(e[Math.ceil(r)]),(r-l)*100).toHexString()}function o(t,e){return e*(t=Math.min(t=Math.max(t,0),1))+2}function s(t){return 16172352e5+t/65536}function i(t,e){let r=[e,a.rS.colors.yellow["200"],a.rS.colors.orange["300"],a.rS.colors.red["400"]].map(t=>(0,n.H)(t));if(t<=1e4)return e;if(t>=3e5)return a.rS.colors.red["400"];let l=Math.log(1e4),o=(Math.log(t)-l)/(Math.log(3e5)-l)*(r.length-1),s=Math.floor(o);return(0,n.H)(r[s]).mix((0,n.H)(r[Math.ceil(o)]),(o-s)*100).toHexString()}},70663:function(t,e,r){r.d(e,{P:function(){return o}});var a=r(66459),n=r(35049),l=r(29286);function o(t,e,r,o){return function(){let s=new URLSearchParams;(null==o?void 0:o.at)&&s.append("at",o.at.toString()),(null==o?void 0:o.timeOffset)&&s.append("time_offset",o.timeOffset.toString());let i=s.toString(),c=i?"?".concat(i):"";l.ZP.get("/metrics/streaming_stats_prometheus".concat(c)).then(e=>{let a=n.kl.fromJSON(e),l=new Map;for(let[t,e]of Object.entries(a.channelStats))l.set(t,{actorCount:e.actorCount,backpressureRate:e.backpressureRate,recvThroughput:e.recvThroughput,sendThroughput:e.sendThroughput});t.setChannelStats(l),"relation"===r&&t.setRelationStats&&a.relationStats?t.setRelationStats(a.relationStats):"fragment"===r&&t.setFragmentStats&&a.fragmentStats&&t.setFragmentStats(a.fragmentStats)},o=>{console.error("Prometheus stats failed, falling back to embedded dashboard:",o),l.ZP.get("/metrics/streaming_stats".concat(c)).then(l=>{let o=n.KK.fromJSON(l),s=new a.ChannelStatsSnapshot(new Map(Object.entries(o.channelStats)),Date.now());e?t.setChannelStats(s.getRate(e)):e=s,"relation"===r&&t.setRelationStats&&o.relationStats?t.setRelationStats(o.relationStats):"fragment"===r&&t.setFragmentStats&&o.fragmentStats&&t.setFragmentStats(o.fragmentStats)},e=>{console.error("Both Prometheus and embedded dashboard failed:",e),t.toast(e,"error")})})}}},66459:function(t,e,r){r.r(e),r.d(e,{ChannelStatsSnapshot:function(){return M},default:function(){return _}});var a=r(85893),n=r(40639),l=r(83234),o=r(20979),s=r(57026),i=r(36696),c=r(47741),d=r(49379),u=r(97098),h=r(96486),m=r.n(h),p=r(9008),f=r.n(p),g=r(95100),x=r(67294),v=r(52189),y=r(50361),S=r.n(y);function j(t){let{fragmentDependency:e,svgWidth:r,selectedId:n,onSelectedIdChange:l}=t,o=(0,x.useRef)(null),[s,i]=(0,x.useState)("0px"),c=(0,x.useCallback)(()=>{let t=(0,u.zx)().nodeSize([10,34,5]),r=S()(e),{width:a,height:n}=t(r);return{width:a,height:n,dag:r}},[e])();return(0,x.useEffect)(()=>{let{width:t,height:e,dag:a}=c,s=o.current,u=d.Ys(s),h=d.ak_,m=d.jvg().curve(h).x(t=>{let{x:e}=t;return e+10}).y(t=>{let{y:e}=t;return e}),p=t=>t.data.id===n,f=u.select(".edges").selectAll(".edge").data(a.links()),g=t=>t.attr("d",t=>{let{points:e}=t;return m(e)}).attr("fill","none").attr("stroke-width",t=>p(t.source)||p(t.target)?2:1).attr("stroke",t=>p(t.source)||p(t.target)?v.rS.colors.blue["500"]:v.rS.colors.gray["300"]);f.exit().remove(),f.enter().call(t=>t.append("path").attr("class","edge").call(g)),f.call(g);let x=u.select(".nodes").selectAll(".node").data(a.descendants()),y=t=>t.attr("transform",t=>"translate(".concat(t.x+10,", ").concat(t.y,")")).attr("fill",t=>p(t)?v.rS.colors.blue["500"]:v.rS.colors.gray["500"]);x.exit().remove(),x.enter().call(t=>t.append("circle").attr("class","node").attr("r",5).call(y)),x.call(y);let S=u.select(".labels").selectAll(".label").data(a.descendants()),j=t=>t.text(t=>t.data.name).attr("x",r-10).attr("font-family","inherit").attr("text-anchor","end").attr("alignment-baseline","middle").attr("y",t=>t.y).attr("fill",t=>p(t)?v.rS.colors.black["500"]:v.rS.colors.gray["500"]).attr("font-weight","600");S.exit().remove(),S.enter().call(t=>t.append("text").attr("class","label").call(j)),S.call(j);let b=u.select(".overlays").selectAll(".overlay").data(a.descendants()),I=t=>t.attr("x",3).attr("height",24).attr("width",r-6).attr("y",t=>t.y-5-12+2+3).attr("rx",5).attr("fill",v.rS.colors.gray["500"]).attr("opacity",0).style("cursor","pointer");b.exit().remove(),b.enter().call(t=>t.append("rect").attr("class","overlay").call(I).on("mouseover",function(t,e){d.Ys(this).transition().duration(parseInt(v.rS.transition.duration.normal)).attr("opacity",".10")}).on("mouseout",function(t,e){d.Ys(this).transition().duration(parseInt(v.rS.transition.duration.normal)).attr("opacity","0")}).on("mousedown",function(t,e){d.Ys(this).transition().duration(parseInt(v.rS.transition.duration.normal)).attr("opacity",".20")}).on("mouseup",function(t,e){d.Ys(this).transition().duration(parseInt(v.rS.transition.duration.normal)).attr("opacity",".10")}).on("click",function(t,e){l&&l(e.data.id)})),b.call(I),i("".concat(e,"px"))},[e,n,r,l,c]),(0,a.jsxs)("svg",{ref:o,width:"".concat(r,"px"),height:s,children:[(0,a.jsx)("g",{className:"edges"}),(0,a.jsx)("g",{className:"nodes"}),(0,a.jsx)("g",{className:"labels"}),(0,a.jsx)("g",{className:"overlays"})]})}var b=r(39653),I=r(79351),w=r(63679),k=r(70681),C=r(23924);let T=(0,w.ZP)(()=>r.e(171).then(r.t.bind(r,55171,23)));function z(t){let{planNodeDependencies:e,fragmentDependency:r,selectedFragmentId:n,channelStats:l,fragmentStats:o}=t,s=(0,x.useRef)(null),{isOpen:i,onOpen:u,onClose:h}=(0,b.qY)(),[m,p]=(0,x.useState)(),f=(0,x.useCallback)(t=>{p(t),u()},[u,p]),{svgWidth:g,svgHeight:y,edges:j,layoutResult:w,includedFragmentIds:z}=(0,x.useCallback)(()=>{let t=S()(e),a=S()(r),n=new Map,l=new Set;for(let[e,r]of t){var o;let t=function(t,e){let{dx:r,dy:a}=e,n=d.G_s().nodeSize([a,r])(t);return n.each(t=>([t.x,t.y]=[t.y,t.x])),n.each(t=>t.x=-t.x),n}(r,{dx:72,dy:48}),{width:a,height:s}=function(t,e){let{margin:{top:r,bottom:a,left:n,right:l}}=e,o=1/0,s=-1/0,i=1/0,c=-1/0;return t.each(t=>s=t.x>s?t.x:s),t.each(t=>o=t.x<o?t.x:o),t.each(t=>c=t.y>c?t.y:c),t.each(t=>i=t.y<i?t.y:i),o-=n,s+=l,i-=r,c+=a,t.each(t=>t.x=t.x-o),t.each(t=>t.y=t.y-i),{width:s-o,height:c-i}}(t,{margin:{left:48,right:48,top:36,bottom:48}});n.set(e,{layoutRoot:t,width:a,height:s,actorIds:null!==(o=r.data.actorIds)&&void 0!==o?o:[]}),l.add(e)}let s=new k.graphlib.Graph;s.setGraph({rankdir:"LR",nodesep:48,ranksep:60,marginx:24,marginy:24}),s.setDefaultEdgeLabel(()=>({})),a.forEach(t=>{let{id:e,parentIds:r}=t,a=n.get(e);s.setNode(e,a)}),a.forEach(t=>{let{id:e,parentIds:r}=t;null==r||r.forEach(t=>{s.setEdge(t,e)})}),k.layout(s);let i=s.nodes().map(t=>{let e=s.node(t);return{id:t,x:e.x-e.width/2,y:e.y-e.height/2,width:e.width,height:e.height,layoutRoot:e.layoutRoot,actorIds:e.actorIds}}),c=s.edges().map(t=>{let e=s.edge(t);return{source:t.v,target:t.w,points:e.points||[]}}),u=0,h=0;return i.forEach(t=>{let{x:e,y:r,width:a,height:n}=t;u=Math.max(u,e+a+50),h=Math.max(h,r+n+50)}),{layoutResult:i,svgWidth:u,svgHeight:h,edges:c,includedFragmentIds:l}},[e,r])();return(0,x.useEffect)(()=>{if(w){let t=Date.now(),e=s.current,r=d.Ys(e),a=d.h5h().x(t=>t.x).y(t=>t.y),i=t=>t===n,c=e=>{e.attr("transform",t=>{let{x:e,y:r}=t;return"translate(".concat(e,", ").concat(r,")")});let r=e.select(".text-frag-id");r.empty()&&(r=e.append("text").attr("class","text-frag-id")),r.attr("fill","black").text(t=>{let{id:e}=t;return"Fragment ".concat(e)}).attr("font-family","inherit").attr("text-anchor","end").attr("dy",t=>{let{height:e}=t;return e+12}).attr("dx",t=>{let{width:e}=t;return e}).attr("fill","black").attr("font-size",12);let n=e.select(".text-actor-id");n.empty()&&(n=e.append("text").attr("class","text-actor-id")),n.attr("fill","black").text(t=>{let{actorIds:e}=t;return"Actor ".concat(e.join(", "))}).attr("font-family","inherit").attr("text-anchor","end").attr("dy",t=>{let{height:e}=t;return e+24}).attr("dx",t=>{let{width:e}=t;return e}).attr("fill","black").attr("font-size",12);let l=e.select(".bounding-box");l.empty()&&(l=e.append("rect").attr("class","bounding-box")),l.attr("width",t=>{let{width:e}=t;return e}).attr("height",t=>{let{height:e}=t;return e}).attr("x",0).attr("y",0).attr("fill",o?e=>{let{id:r}=e,a=parseInt(r);if(isNaN(a)||!o[a])return"white";let n=(0,C.Jv)(o[a].currentEpoch);return(0,C.qC)(t-n,"white")}:"white").attr("stroke-width",t=>{let{id:e}=t;return i(e)?3:1}).attr("rx",5).attr("stroke",t=>{let{id:e}=t;return i(e)?v.rS.colors.blue[500]:v.rS.colors.gray[500]});let s=e=>{var r;let a=parseInt(e),n=null==o?void 0:o[a],l=n?((t-(0,C.Jv)(n.currentEpoch))/1e3).toFixed(2):"N/A",s=null!==(r=null==n?void 0:n.currentEpoch)&&void 0!==r?r:"N/A";return"<b>Fragment ".concat(a,"</b><br>Epoch: ").concat(s,"<br>Latency: ").concat(l," seconds")};l.on("mouseover",(t,e)=>{let{id:r}=e;d.td_(".tooltip").remove(),d.Ys("body").append("div").attr("class","tooltip").style("position","absolute").style("background","white").style("padding","10px").style("border","1px solid #ddd").style("border-radius","4px").style("pointer-events","none").style("left",t.pageX+10+"px").style("top",t.pageY+10+"px").style("font-size","12px").html(s(r))}).on("mousemove",t=>{d.Ys(".tooltip").style("left",t.pageX+10+"px").style("top",t.pageY+10+"px")}).on("mouseout",()=>{d.td_(".tooltip").remove()});let c=e.select(".edges");c.empty()&&(c=e.append("g").attr("class","edges"));let u=t=>t.attr("d",a),h=c.selectAll("path").data(t=>{let{layoutRoot:e}=t;return e.links()});h.enter().call(t=>(t.append("path").attr("fill","none").attr("stroke",v.rS.colors.gray[700]).attr("stroke-width",1.5).call(u),t)),h.call(u),h.exit().remove();let m=e.select(".nodes");m.empty()&&(m=e.append("g").attr("class","nodes"));let p=t=>{t.attr("transform",t=>"translate(".concat(t.x,",").concat(t.y,")"));let e=t.select("circle");e.empty()&&(e=t.append("circle")),e.attr("fill",v.rS.colors.blue[500]).attr("r",12).style("cursor","pointer").on("click",(t,e)=>f(e.data));let r=t.select("text");r.empty()&&(r=t.append("text")),r.attr("fill","black").text(t=>t.data.name).attr("font-family","inherit").attr("text-anchor","middle").attr("dy",21.6).attr("fill","black").attr("font-size",12).attr("transform","rotate(-8)");let a=t.select("title");return a.empty()&&(a=t.append("title")),a.text(t=>{var e;return null!==(e=t.data.node.identity)&&void 0!==e?e:t.data.name}),t},g=m.selectAll(".stream-node").data(t=>{let{layoutRoot:e}=t;return e.descendants()});g.exit().remove(),g.enter().call(t=>t.append("g").attr("class","stream-node").call(p)),g.call(p)},u=r.select(".fragments").selectAll(".fragment").data(w);u.enter().call(t=>t.append("g").attr("class","fragment").call(c)),u.call(c),u.exit().remove();let h=r.select(".fragment-edges").selectAll(".fragment-edge").data(j),m=d.$0Z,p=d.jvg().curve(m).x(t=>{let{x:e}=t;return e}).y(t=>{let{y:e}=t;return e}),g=t=>{let e=t.select("path");e.empty()&&(e=t.append("path"));let r=t=>i(t.source)||i(t.target);return e.attr("d",t=>{let{points:e}=t;return p(e)}).attr("fill","none").attr("stroke-width",t=>{if(l){var e;let r=null===(e=l.get("".concat(t.source,"_").concat(t.target)))||void 0===e?void 0:e.backpressureRate;if(r)return(0,C.b4)(r,30)}return r(t)?4:2}).attr("stroke",t=>{if(l){var e;let r=null===(e=l.get("".concat(t.source,"_").concat(t.target)))||void 0===e?void 0:e.backpressureRate;if(r)return(0,C.k)(r)}return r(t)?v.rS.colors.blue["500"]:v.rS.colors.gray["300"]}),e.on("mouseover",(t,e)=>{d.td_(".tooltip").remove();let r=null==l?void 0:l.get("".concat(e.source,"_").concat(e.target)),a="<b>Fragment ".concat(e.source," â†’ ").concat(e.target,"</b><br>Backpressure: ").concat((null==r?void 0:r.backpressureRate)!=null?"".concat((100*r.backpressureRate).toFixed(2),"%"):"N/A","<br>Recv Throughput: ").concat((null==r?void 0:r.recvThroughput)!=null?"".concat(r.recvThroughput.toFixed(2)," rows/s"):"N/A","<br>Send Throughput: ").concat((null==r?void 0:r.sendThroughput)!=null?"".concat(r.sendThroughput.toFixed(2)," rows/s"):"N/A");d.Ys("body").append("div").attr("class","tooltip").style("position","absolute").style("background","white").style("padding","10px").style("border","1px solid #ddd").style("border-radius","4px").style("pointer-events","none").style("left",t.pageX+10+"px").style("top",t.pageY+10+"px").style("font-size","12px").html(a)}).on("mousemove",t=>{d.Ys(".tooltip").style("left",t.pageX+10+"px").style("top",t.pageY+10+"px")}).on("mouseout",()=>{d.td_(".tooltip").remove()}),t};h.enter().call(t=>t.append("g").attr("class","fragment-edge").call(g)),h.call(g),h.exit().remove()}},[w,j,l,o,n,f]),(0,a.jsxs)(x.Fragment,{children:[(0,a.jsxs)(I.u_,{isOpen:i,onClose:h,size:"5xl",children:[(0,a.jsx)(I.ZA,{}),(0,a.jsxs)(I.hz,{children:[(0,a.jsxs)(I.xB,{children:[null==m?void 0:m.operatorId," - ",null==m?void 0:m.name]}),(0,a.jsx)(I.ol,{}),(0,a.jsx)(I.fe,{children:i&&(null==m?void 0:m.node)&&(0,a.jsx)(T,{shouldCollapse:t=>{let{name:e}=t;return"input"===e||"fields"===e||"streamKey"===e},src:m.node,collapsed:3,name:null,displayDataTypes:!1})}),(0,a.jsx)(I.mz,{children:(0,a.jsx)(c.zx,{colorScheme:"blue",mr:3,onClick:h,children:"Close"})})]})]}),(0,a.jsxs)("svg",{ref:s,width:"".concat(g,"px"),height:"".concat(y,"px"),children:[(0,a.jsx)("g",{className:"fragment-edges"}),(0,a.jsx)("g",{className:"fragments"})]})]})}var N=r(17043),D=r(56103),R=r(51388),E=r(3047),A=r(55992),F=r(70663);class M{getRate(t){let e=new Map;for(let[r,a]of this.metrics){let n=t.metrics.get(r);if(n){let l=this.time-t.time;e.set(r,{actorCount:a.actorCount,backpressureRate:(a.outputBlockingDuration-n.outputBlockingDuration)/n.actorCount/l/1e6,recvThroughput:(a.recvRowCount-n.recvRowCount)/l*1e3,sendThroughput:(a.sendRowCount-n.sendRowCount)/l*1e3})}}return e}constructor(t,e){this.metrics=t,this.time=e}}function _(){var t,e,r;let{response:h}=(0,E.Z)(A.gG),{response:p}=(0,E.Z)(A.KY),[v,y]=(0,g.v1)("id",g.U),[S,b]=(0,x.useState)(),[I,w]=(0,x.useState)(),k=(0,x.useMemo)(()=>null==h?void 0:h.find(t=>t.id===v),[h,v]),C=(0,R.Z)();(0,x.useEffect)(()=>{v&&(w(void 0),(0,A.Dx)(v).then(t=>{w(t)}))},[v]);let T=(0,x.useCallback)(()=>{if(I){let t=function(t){let e=[],r=new Map;for(let e in t.fragments)for(let a of t.fragments[e].actors)r.set(a.actorId,a.fragmentId);for(let r in t.fragments){let a=t.fragments[r],n=new Set,l=new Set;for(let e of a.upstreamFragmentIds)t.fragments[e]?n.add(e):l.add(e);e.push({id:a.fragmentId.toString(),name:"Fragment ".concat(a.fragmentId),parentIds:Array.from(n).map(t=>t.toString()),externalParentIds:Array.from(l).map(t=>t.toString()),width:0,height:0,order:a.fragmentId,fragment:a})}return e}(I);return{fragments:I,fragmentDep:t,fragmentDepDag:(0,u.lu)()(t)}}},[I]);(0,x.useEffect)(()=>{h&&!v&&h.length>0&&y(h[0].id)},[v,h,y]);let M=null===(t=T())||void 0===t?void 0:t.fragmentDep,_=null===(e=T())||void 0===e?void 0:e.fragmentDepDag,Y=null===(r=T())||void 0===r?void 0:r.fragments,P=(0,x.useCallback)(()=>{let t=null==Y?void 0:Y.fragments;if(t){let e=new Map;for(let r in t){let a=function(t){let e;let r=t.actors[0],a=t=>{var e,r;return{name:(null===(r=t.nodeBody)||void 0===r?void 0:null===(e=r.$case)||void 0===e?void 0:e.toString())||"unknown",children:(t.input||[]).map(a),operatorId:t.operatorId,node:t}};if(r.dispatcher.length>0){let t=m().camelCase(r.dispatcher[0].type.replace(/^DISPATCHER_TYPE_/,""));e=r.dispatcher.length>1?r.dispatcher.every(t=>t.type===r.dispatcher[0].type)?"".concat(t,"Dispatchers"):"multipleDispatchers":"".concat(t,"Dispatcher")}else e="noDispatcher";let n=t.actors.reduce((t,e)=>(t[e.actorId]=e.dispatcher,t),{});return n.fragment={...t,actors:[]},d.bT9({name:e,actorIds:t.actors.map(t=>t.actorId.toString()),children:t.nodes?[a(t.nodes)]:[],operatorId:"dispatcher",node:n})}(t[r]);e.set(r,a)}return e}},[null==Y?void 0:Y.fragments])(),[Z,O]=(0,x.useState)(""),[X,G]=(0,x.useState)(""),H=()=>{let t=parseInt(X);if(p){let e=p.map;for(let r in e){let a=e[r].map;for(let e in a)if(parseInt(e)==t){y(parseInt(r)),b(t);return}}}C(Error("Fragment ".concat(t," not found")))},W=()=>{let t=parseInt(Z);if(p){let e=p.map;for(let r in e){let a=e[r].map;for(let e in a)if(a[e].ids.includes(t)){y(parseInt(r)),b(parseInt(e));return}}}C(Error("Actor ".concat(t," not found")))},[U,J]=(0,x.useState)(),[B,L]=(0,x.useState)(),[K,q]=(0,x.useState)();(0,x.useEffect)(()=>{let t;let e=(0,F.P)({setChannelStats:J,setFragmentStats:L,toast:C},t,"fragment",K);e();let r=setInterval(e,5e3);return()=>{clearInterval(r)}},[C,K]);let $=(0,a.jsxs)(n.kC,{p:3,height:"calc(100vh - 20px)",flexDirection:"column",children:[(0,a.jsx)(D.Z,{children:"Fragment Graph"}),(0,a.jsxs)(n.kC,{flexDirection:"row",height:"full",width:"full",children:[(0,a.jsxs)(n.gC,{mr:3,spacing:3,alignItems:"flex-start",width:225,height:"full",children:[(0,a.jsx)(N.Z,{onApply:(t,e)=>{q({at:t,timeOffset:e})}}),(0,a.jsxs)(l.NI,{children:[(0,a.jsx)(l.lX,{children:"Streaming Jobs"}),(0,a.jsx)(o.II,{list:"relationList",spellCheck:!1,onChange:t=>{var e;let r=null==h?void 0:null===(e=h.find(e=>e.name==t.target.value))||void 0===e?void 0:e.id;r&&y(r)},placeholder:"Search...",mb:2}),(0,a.jsx)("datalist",{id:"relationList",children:h&&h.map(t=>(0,a.jsxs)("option",{value:t.name,children:["(",t.id,") ",t.name]},t.id))}),(0,a.jsx)(s.Ph,{value:null!=v?v:void 0,onChange:t=>y(parseInt(t.target.value)),children:h&&h.map(t=>(0,a.jsxs)("option",{value:t.id,children:["(",t.id,") ",t.name]},t.name))})]}),k&&(0,a.jsxs)(l.NI,{children:[(0,a.jsx)(l.lX,{children:"Information"}),(0,a.jsx)(i.xJ,{children:(0,a.jsx)(i.iA,{size:"sm",children:(0,a.jsxs)(i.p3,{children:[(0,a.jsxs)(i.Tr,{children:[(0,a.jsx)(i.Td,{fontWeight:"medium",children:"Type"}),(0,a.jsx)(i.Td,{isNumeric:!0,children:k.type})]}),(0,a.jsxs)(i.Tr,{children:[(0,a.jsx)(i.Td,{fontWeight:"medium",children:"Status"}),(0,a.jsx)(i.Td,{isNumeric:!0,children:k.jobStatus})]}),(0,a.jsxs)(i.Tr,{children:[(0,a.jsx)(i.Td,{fontWeight:"medium",children:"Parallelism"}),(0,a.jsx)(i.Td,{isNumeric:!0,children:k.parallelism})]}),(0,a.jsxs)(i.Tr,{children:[(0,a.jsx)(i.Td,{fontWeight:"medium",paddingEnd:0,children:"Max Parallelism"}),(0,a.jsx)(i.Td,{isNumeric:!0,children:k.maxParallelism})]})]})})})]}),(0,a.jsxs)(l.NI,{children:[(0,a.jsx)(l.lX,{children:"Goto"}),(0,a.jsxs)(n.gC,{spacing:2,children:[(0,a.jsxs)(n.Ug,{children:[(0,a.jsx)(o.II,{placeholder:"Fragment Id",value:X,onChange:t=>G(t.target.value)}),(0,a.jsx)(c.zx,{onClick:t=>H(),children:"Go"})]}),(0,a.jsxs)(n.Ug,{children:[(0,a.jsx)(o.II,{placeholder:"Actor Id",value:Z,onChange:t=>O(t.target.value)}),(0,a.jsx)(c.zx,{onClick:t=>W(),children:"Go"})]})]})]}),(0,a.jsxs)(n.kC,{height:"full",width:"full",flexDirection:"column",children:[(0,a.jsx)(n.xv,{fontWeight:"semibold",children:"Fragments"}),_&&(0,a.jsx)(n.xu,{flex:"1",overflowY:"scroll",children:(0,a.jsx)(j,{svgWidth:225,fragmentDependency:_,onSelectedIdChange:t=>b(parseInt(t)),selectedId:null==S?void 0:S.toString()})})]})]}),(0,a.jsxs)(n.xu,{flex:1,height:"full",ml:3,overflowX:"scroll",overflowY:"scroll",children:[(0,a.jsx)(n.xv,{fontWeight:"semibold",children:"Fragment Graph"}),P&&M&&(0,a.jsx)(z,{selectedFragmentId:null==S?void 0:S.toString(),fragmentDependency:M,planNodeDependencies:P,channelStats:U,fragmentStats:B})]})]})]});return(0,a.jsxs)(x.Fragment,{children:[(0,a.jsx)(f(),{children:(0,a.jsx)("title",{children:"Streaming Fragments"})}),$]})}}}]);